function OUTPUT=myrotate_mb(INPUT,phi)INPUT = double(INPUT);% 3-step image rotation by shearing% phi is the rotation angle in grad.% Call OUTPUT=rotate(INPUT,phi); [SzX, SzY] =size(INPUT);phi=pi*phi/180;OUTPUT=zeros(size(INPUT));%FIRST PASSu=(1-cos(phi))/sin(phi);for x=1:SzX,    Ux=u*(x-SzX/2-1/2);    My=zeros(1,SzY);    r=1:SzY/2+1; Wn=1i*2*pi*Ux/SzY;    My(r)=exp(Wn*(r-1));     My(SzY:-1:SzY/2+2)=conj(My(2:SzY/2));    spinput=fftnorm_mb(INPUT(x,:));    spinput=spinput.*My;    OUTPUT(x,:)=real(ifftnorm_mb([spinput(1:SzY/2) real(spinput(SzY/2+1)) spinput(SzY/2+2:SzY)]));end% SECOND PASSu=-sin(phi);for y=1:SzY,    Uy=u*(y-SzY/2-1/2);    Mx=zeros(SzY,1);    r=1:SzX/2+1;     Wn=1i*2*pi*Uy/SzX;    Mx(r)=exp(Wn*(r-1)); Mx(SzX:-1:SzX/2+2)=conj(Mx(2:SzX/2));    spinput=fftnorm_mb(OUTPUT(:,y));    spinput=spinput.*Mx;    OUTPUT(:,y)=real(ifftnorm_mb([spinput(1:SzX/2);real(spinput(SzX/2+1));spinput(SzX/2+2:SzX)]));end%THIRD PASSu=(1-cos(phi))/sin(phi);for x=1:SzX,    Ux=u*(x-SzX/2-1/2);    My=zeros(1,SzY);    r=1:SzY/2+1; Wn=1i*2*pi*Ux/SzY;    My(r)=exp(Wn*(r-1));     My(SzY:-1:SzY/2+2)=conj(My(2:SzY/2));    spinput=fftnorm_mb(OUTPUT(x,:));    spinput=spinput.*My;    OUTPUT(x,:)=round(real(ifftnorm_mb([spinput(1:SzY/2) real(spinput(SzY/2+1)) spinput(SzY/2+2:SzY)])));endOUTPUT=(OUTPUT>=0).*OUTPUT;OUTPUT=(OUTPUT<=255).*OUTPUT+255*ones(size(OUTPUT)).*(OUTPUT>255);% OUTPUT=[OUTPUT1 OUTPUT2 OUTPUT];