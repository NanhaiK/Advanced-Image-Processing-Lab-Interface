function OUTIMG=lcros_mb(INPIMG,LX,LY,ROS)% LOCAL ROS FILTERING OVER WINDOW (LX=2Lx+1,LY=2Ly+1)% Image mirror extension by the size of the spatial window% Call OUTIMG=lcros(INPIMG,LX,LY,ROS);INPIMG = double(INPIMG);Lx=round((LX-1)/2);Ly=round((LY-1)/2);[SzX SzY]=size(INPIMG);OUTIMG=INPIMG;imgext=img_ext_mb(INPIMG,Ly,Lx);% LOCAL RANK ORDER STATISTICSfor X0=1:SzX,	% FORMATION OF NEIGHBORHOOD MATRIX	nbhood=zeros((2*Lx+1)*(2*Ly+1),SzY);	Y=1:SzY;	for y=-Ly:Ly,        nbhood((2*Lx+1)*(Ly+y)+1:(2*Lx+1)*(Ly+y+1),Y)=imgext(X0:X0+2*Lx,Y+Ly+y);	endsortnbhood=sort(nbhood);OUTIMG(X0,:)=sortnbhood(ROS,:);end 	